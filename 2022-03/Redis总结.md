:q
> > 参考博客：https://xiaolincoding.com/redis/base/redis_interview.html#%E8%AE%A4%E8%AF%86-redis

## 基本数据类型
- string => SDS
- hash => 压缩列表或哈希表
- set => 整数集合或哈希表
- zset => 压缩列表或跳表
- list => quicklist  |  压缩列表或双向链表

## 线程模型
对于部分耗时操作，会由后台线程处理，后台线程相当于消费者，从队列中取对应任务

主线程通过IO多路复用epoll，以及任务分发，做到单线程内高性能切换

## Redis持久化机制
- AOF => AOF重写、AOF刷盘
- RDB
- 混合持久化

AOF重写过程：fork子进程，子进程中有父进程数据副本，如果父进程有写操作，会触发写时复制，若此时有新增写命令，会将AOF命令添加至AOF缓冲区，等待重写过程
结束后，再补充到AOF中

RDB快照：分为save和bgsave  fork子进程操作

### 为什么是fork子进程而不是线程？
fork进程，利用操作系统能力就可以共享父进程内存，通过父进程有写操作时也会触发写时复制，通过线程还需要加锁控制并发问题，影响性能。

## Redis淘汰机制

## 缓存雪崩
大量缓存同时失效

每个key设置过期时间时增加一个随机数

## 缓存击穿
我们的业务通常会有几个数据会被频繁地访问，比如秒杀活动，这类被频地访问的数据被称为热点数据。

如果缓存中的某个热点数据过期了，此时大量的请求访问了该热点数据，就无法从缓存中读取，直接访问数据库，数据库很容易就被高并发的请求冲垮，这就是缓存击穿的问题。

- 互斥锁方案（Redis 中使用 setNX 方法设置一个状态位，表示这是一种锁定状态），保证同一时间只有一个业务线程请求缓存，未能获取互斥锁的请求，要么等待锁释放后重新读取缓存，要么就返回空值或者默认值。
- 不给热点数据设置过期时间，由后台异步更新缓存，或者在热点数据准备要过期前，提前通知后台线程更新缓存以及重新设置过期时间；

## 缓存穿透
大量不存在的key直接打到数据库，导致数据库挂了

通过布隆过滤器先进行一层过滤，判断数据是否存在

## 缓存预热
...

## 缓存更新策略
- Cache Aside 旁路缓存：读时读缓存，不存在读数据库后更新缓存，更新时先更新数据库，更新成功后删除缓存
- 读穿/写穿 Read Through/ Write Through
- Write Back 写回策略 （CPU缓存和文件系统的Page Cache等）

## 缓存降级
... 设置降级策略，直接返回默认值

## 集群、哨兵
- Cluster  哈希槽 一致性哈希
  - [Redis集群使用一致性哈希和哈希槽区别](https://www.jianshu.com/p/3f1c801b22ff)
- Sentinel 哨兵，主从切换

## 常见问题

### Redis中的hash结构和Java HashMap扩容的差异？
Redis中hash扩容是渐进式扩容，可以把扩容耗时均摊给每次请求，扩容期间同时存在两个hashtable，对redis的查询、删除、修改、插入同时会将rehashidx处的key迁移到新的table，
当rehashidx达到原先table最大长度时，扩容完成...

HashMap是直接完成，扩容后将所有元素复制到新的hashtable

### Redis如何实现一个无限大的数据库
Redis集群，通过slot槽位，分配不同的槽给不同的redis server，key通过CRC算法计算存储的对应槽位

### aof文件优化策略？
aof文件重写，通过已有key生成命令

### 跳表数据结构，插入数据时怎么选择哪一层？
https://www.jianshu.com/p/9d8296562806
https://blog.csdn.net/m0_49834705/article/details/112465244
https://www.jianshu.com/p/54d37710b2a6

### 为什么Redis选择使用跳表而不是红黑树来实现有序集合？
Redis 中的有序集合(zset) 支持的操作：
- 插入一个元素
- 删除一个元素
- 查找一个元素
- 有序输出所有元素
- 按照范围区间查找元素（比如查找值在 [100, 356] 之间的数据）

其中，前四个操作红黑树也可以完成，且时间复杂度跟跳表是一样的。但是，按照区间来查找数据这个操作，红黑树的效率没有跳表高。按照区间查找数据时，跳表可以做到 O(logn) 的时间复杂度定位区间的起点，然后在原始链表中顺序往后遍历就可以了，非常高效。

### 如何实现分布式延时队列
https://juejin.cn/post/6844904016434970637
